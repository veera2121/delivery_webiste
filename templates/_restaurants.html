<div class="restaurant-row">
{% for r in restaurants %}

    {# ğŸ”¹ OPEN STATUS #}
    
    {% set is_open = (
        r.opening_time and r.closing_time and
        r.opening_time <= now <= r.closing_time
    ) %}

       

    <div class="card
        {% if not r.deliverable or not is_open %} disabled {% endif %}"
        {% if r.deliverable and is_open %}
            onclick="window.location.href='/menu/{{ r.id }}'"
        {% endif %}
    >

        {# ğŸš« NOT DELIVERABLE #}
        {% if not r.deliverable %}
            <div class="info-box not-deliverable">
                ğŸš« Not delivering to your location
            </div>
        {% endif %}
          
        {# â° STATUS MESSAGE #}
        {% if not r.opening_time or not r.closing_time %}
            <div class="info-box closed-box">
                âŒ Closed â€” Timing not updated
            </div>

        {% elif now < r.opening_time %}
            <div class="info-box closed-box">
                â³ Opens today at {{ r.opening_time.strftime("%I:%M %p") }}

            </div>

        {% elif now > r.closing_time %}
            <div class="info-box closed-box">
                ğŸŒ™ Closed for today â€” Opens tomorrow at {{ r.opening_str }}
            </div>

        {% endif %}
             
        {# ğŸ”¥ OFFER #}
        {% if r.active_offer and r.deliverable and is_open %}
            <div class="info-box offer-box">
                ğŸ”¥ {{ r.active_offer.title }} â€” {{ r.active_offer.description }}
            </div>
        {% endif %}

                <img 
            src="/static/images/restaurants/{{ r.id }}.jpg"
            alt="{{ r.name }}"
            onerror="this.onerror=null; this.src='/static/images/restaurants/img1.jpg';"
            >


        <div class="content">
            <div class="restaurant-name">{{ r.name }}</div>

            {% if r.is_veg %}
                <div class="veg-badge">Veg</div>
            {% else %}
                <div class="nonveg-badge">Non-Veg</div>
            {% endif %}

            <div class="details">
                <div class="rating">{{ r.rating }} â­</div>
                <div class="price">{{ r.price_level }}</div>
                <div class="time">{{ r.delivery_time }}</div>
            </div>

            <div class="popular">ğŸ½ï¸ {{ r.popular_items }}</div>

            {% if r.free_delivery_limit > 0 %}
                <div class="free-delivery">
                    ğŸšš Free Delivery on â‚¹{{ r.free_delivery_limit }}+
                </div>
            {% else %}
                <div class="delivery-charge">
                    ğŸšš Delivery â‚¹{{ r.delivery_charge }}
                </div>
            {% endif %}

            <div class="open-close">
                ğŸ•’
                {% if r.opening_time and r.closing_time %}
                    {{ r.opening_time.strftime("%I:%M %p") }}
                    -
                    {{ r.closing_time.strftime("%I:%M %p") }}
                {% else %}
                    Timing not available
                {% endif %}
            </div>


          {% if r.deliverable and is_open and r.is_accepting_orders %}
    <a href="/menu/{{ r.id }}" class="view-btn">View Menu</a>
{% else %}
    {% set msg = "Currently not accepting orders" %}

    {% if not r.is_accepting_orders and r.accept_orders_until %}
        {% set msg = "Accepting orders after " ~ r.accept_orders_until.strftime("%I:%M %p") %}
    {% elif not is_open %}
        {% set msg = "Restaurant is closed now" %}
    {% elif not r.deliverable %}
        {% set msg = "Not delivering to your location" %}
    {% endif %}

    <button class="view-btn disabled-btn"
            onclick="showFlash('{{ msg }}')">
        View Menu
    </button>
{% endif %}

        </div>

    </div>


{% endfor %}
</div>
</div>

{% if trending_items|length > 0 %}
<section class="trending-section">
    <h2>ğŸ”¥ Trending in {{ selected_location }}</h2>

    <div class="trending-grid">
        {% for item in trending_items %}
        <div class="food-card">
            <span class="badge">ğŸ”¥ Trending</span>
            <h4>{{ item.name }}</h4>
            <p>â‚¹{{ item.price }}</p>
            <small>
                From {{ item.restaurant.name if item.restaurant else "Unknown" }}
            </small>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}
