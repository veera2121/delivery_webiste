{% extends "base.html" %}
{% block title %}Platform Offers{% endblock %}

{% block content %}
<div class="container mt-4">

    <h2>Platform Offers</h2>

    <!-- ===== Add New Offer ===== -->
    <div class="card mb-4">
        <div class="card-header">
            <strong>Add New Offer</strong>
        </div>
        <div class="card-body">
            <form action="{{ url_for('manage_platform_offers') }}" method="POST">
                <div class="mb-3">
                    <label for="coupon_code" class="form-label">Coupon Code</label>
                    <input type="text" name="coupon_code" id="coupon_code" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Offer Type</label>
                    <select name="offer_type" class="form-select">
                        <option value="percent">Percent (%)</option>
                        <option value="flat">Flat (â‚¹)</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="offer_value" class="form-label">Offer Value</label>
                    <input type="number" step="0.01" name="offer_value" id="offer_value" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label for="min_order_amount" class="form-label">Minimum Order Amount</label>
                    <input type="number" step="0.01" name="min_order_amount" id="min_order_amount" class="form-control">
                </div>

                <div class="mb-3">
                    <label for="max_discount" class="form-label">Maximum Discount</label>
                    <input type="number" step="0.01" name="max_discount" id="max_discount" class="form-control">
                </div>

                <div class="mb-3 form-check">
                    <input type="checkbox" name="free_delivery" id="free_delivery" class="form-check-input">
                    <label for="free_delivery" class="form-check-label">Free Delivery</label>
                </div>

                <div class="mb-3 form-check">
                    <input type="checkbox" name="is_first_order" id="is_first_order" class="form-check-input">
                    <label for="is_first_order" class="form-check-label">First Order Only</label>
                </div>

                <div class="mb-3">
                    <label class="form-label">Select Restaurants</label>
                    <select name="restaurants" class="form-select" multiple size="5">
                        {% for r in restaurants %}
                        <option value="{{ r.id }}">{{ r.name }}</option>
                        {% endfor %}
                    </select>
                    <small class="text-muted">Hold Ctrl (Cmd on Mac) to select multiple</small>
                </div>

                <button type="submit" class="btn btn-primary">Add Offer</button>
            </form>
        </div>
    </div>

    <!-- ===== Existing Offers ===== -->
    <div class="card">
        <div class="card-header">
            <strong>Existing Offers</strong>
        </div>
        <div class="card-body table-responsive">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Coupon Code</th>
                        <th>Type</th>
                        <th>Value</th>
                        <th>Restaurants</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for offer in offers %}
                    <tr>
                        <td>{{ offer.id }}</td>
                        <td>{{ offer.coupon_code }}</td>
                        <td>{{ offer.offer_type }}</td>
                        <td>{{ offer.offer_value }}</td>
                        <td>
                            {% for r in offer.included_restaurants %}
                                {{ r.name }}{% if not loop.last %}, {% endif %}
                            {% endfor %}
                        </td>
                        <td>{{ "Active" if offer.is_active else "Inactive" }}</td>
                        <td>
                            <a href="{{ url_for('edit_platform_offer', offer_id=offer.id) }}" class="btn btn-sm btn-warning">Edit</a>
                            <a href="{{ url_for('delete_platform_offer', offer_id=offer.id) }}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure?')">Delete</a>
                        </td>
                    </tr>
                    {% endfor %}
                    {% if offers|length == 0 %}
                    <tr>
                        <td colspan="7" class="text-center">No offers yet.</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

</div>
{% endblock %}
