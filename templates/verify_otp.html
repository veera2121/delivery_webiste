<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Verify OTP</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===== PAGE CENTER ===== */
body {
  margin: 0;
  height: 100vh;
  background: #f4f6f8;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: Arial, sans-serif;
}

/* ===== UIVERSE FORM ===== */
.form_main {
  width: 260px;
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: #fff;
  padding: 30px;
  box-shadow: 0 0 40px rgba(0,0,0,.06);
  position: relative;
  overflow: hidden;
  border-radius: 12px;
}

.form_main::before {
  position: absolute;
  content: "";
  width: 300px;
  height: 300px;
  background-color: rgb(209, 193, 255);
  transform: rotate(45deg);
  left: -180px;
  bottom: 30px;
  z-index: 1;
  border-radius: 30px;
}

.heading {
  font-size: 1.6em;
  font-weight: 900;
  margin-bottom: 5px;
  z-index: 2;
}

.sub {
  font-size: .75em;
  font-weight: 700;
  color: #000000;
  margin-bottom: 10px;
  z-index: 2;
}

.inputContainer {
  width: 100%;
  position: relative;
  z-index: 2;
}

.inputField {
  width: 100%;
  height: 34px;
  background: transparent;
  border: none;
  border-bottom: 2px solid #aaa;
  margin: 12px 0;
  font-size: .9em;
  padding-left: 8px;
}

.inputField:focus {
  outline: none;
  border-bottom: 2px solid rgb(162, 104, 255);
}

#button {
  width: 100%;
  border: none;
  background-color: rgb(162, 104, 255);
  height: 34px;
  color: #fff;
  font-size: .8em;
  letter-spacing: 1px;
  margin-top: 10px;
  cursor: pointer;
  z-index: 2;
  border-radius: 6px;
}

#button:hover {
  background-color: rgb(126, 84, 255);
}

/* ===== TIMER & RESEND ===== */
.timer {
  margin-top: 10px;
  font-size: .75em;
  color: #000000;
  z-index: 2;
}

.resend button {
  background: none;
  border: none;
  color: rgb(44, 24, 128);
  font-size: .75em;
  margin-top: 6px;
  cursor: pointer;
}

.resend button:disabled {
  color: #aaa;
  cursor: not-allowed;
}

/* ===== FLASH ===== */
.flash {
  margin-top: 8px;
  font-size: .75em;
  color: red;
  z-index: 2;
  font-weight: 900;
}
</style>
</head>
   {% extends "base.html" %}

{% block title %}Verify OTP{% endblock %}

{% block content %}
<div class="form_main">
  <div class="heading">Verify OTP</div>
  <div class="sub">OTP sent to {{ mobile }}</div>

  <form method="POST" action="{{ url_for('users.verify_otp') }}">
    <input type="hidden" name="mobile" value="{{ mobile }}">
    <div class="inputContainer">
      <input class="inputField" type="text" name="otp" placeholder="Enter OTP" required>
    </div>
    <button id="button" type="submit">VERIFY</button>
  </form>

  <div class="timer">
    Resend OTP in <span id="time">30</span>s
  </div>

  <div class="resend">
    <form id="resendForm" method="POST" action="{{ url_for('users.resend_otp') }}">

      <input type="hidden" name="mobile" value="{{ mobile }}">
      <button id="resendBtn" disabled>Resend OTP</button>
    </form>
  </div>

  {% for msg in get_flashed_messages() %}
    <div class="flash">{{ msg }}</div>
  {% endfor %}
</div>

<script>
const allowResend = {{ 'true' if allow_resend else 'false' }};

let timeLeft = 300;
const timeSpan = document.getElementById("time");
const resendBtn = document.getElementById("resendBtn");
const resendForm = document.getElementById("resendForm");

function startTimer() {
    resendBtn.disabled = true;
    timeLeft = 300;
    timeSpan.innerText = timeLeft;

    const timer = setInterval(() => {
        timeLeft--;
        timeSpan.innerText = timeLeft;

        if (timeLeft <= 0) {
            clearInterval(timer);
            resendBtn.disabled = false;
            timeSpan.innerText = "0";
        }
    }, 1000);
}

/* ðŸ”‘ KEY LOGIC */
if (allowResend) {
    resendBtn.disabled = false;
    timeSpan.innerText = "0";
} else {
    startTimer();
}

/* ðŸ”„ Resend OTP */
resendForm.addEventListener("submit", function(e){
    e.preventDefault();

    fetch(this.action, {
        method: "POST",
        body: new FormData(this)
    })
    .then(() => {
        // After resend â†’ restart timer
        resendBtn.disabled = true;
        startTimer();
    });
});
</script>
{% endblock %}



